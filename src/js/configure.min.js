/*! pimpmylog - 1.7.14 - 025d83c29c6cf8dbb697aa966c9e9f8713ec92f1*/
/*
 * pimpmylog
 * http://pimpmylog.com
 *
 * Copyright (c) 2017 Potsky, contributors
 * Licensed under the GPLv3 license.
 */var user_wants_auth,user_wants_soft=[],logs_list=[],progressbar_active=function(){"use strict";$(".progress").addClass("progress-striped active")},progressbar_deactive=function(){"use strict";$(".progress").removeClass("progress-striped active")},progressbar_set=function(a){"use strict";var b=Math.max(0,Math.min(100,parseInt(a,10)));$(".progress .sr-only").text(lemma.complete.replace("%s",b)),$(".progress-bar").attr("aria-valuenow",b).width(b+"%")},progressbar_color=function(a){"use strict";$(".progress-bar").removeClass("progress-bar-success progress-bar-info progress-bar-warning progress-bar-success progress-bar-danger"),void 0!==a&&$(".progress-bar").addClass("progress-bar-"+a)},fatal_error=function(a,b){"use strict";a||(a=lemma.error),b?$("#user").html(b):$("#user").text(""),progressbar_color("danger"),progressbar_set(100),$('<div class="alert alert-danger fade in">'+a+"</div>").appendTo("#error"),$("#reload").hide(),$("#next").hide()},pml_action=function(a,b,c){"use strict";progressbar_active(),$.ajax({url:"configure.php?"+(new Date).getTime()+"&"+querystring,data:a,type:"POST",dataType:"json"}).fail(function(a,b,c){progressbar_color("danger"),progressbar_set(100),$('<div class="alert alert-danger fade in">'+c.message+'<hr/><span class="glyphicon glyphicon-info-sign"></span> '+lemma.suhosin+"<hr/>"+$("<div>").html(a.responseText).text()+"</div>").appendTo("#error")}).done(function(a){a.error?fatal_error(a.error,a.notice?a.notice:""):b(a,c)}).always(function(a){a.reload?$("#reload").show():$("#reload").hide(),a.next?$("#next").show():$("#next").hide().unbind("click"),progressbar_deactive()})},action_configure_now=function(a){"use strict";$("#error").text(""),$("#user").text(""),$(".alert").remove(),progressbar_set(90),pml_action({s:"configure",l:a},function(){for(var b in a)user_wants_soft.push([a[b].s,a[b].t]);var c=$.param({a:user_wants_auth,w:uuid,b:user_wants_soft});progressbar_set(100),progressbar_color("success"),$("#congratulations").append('<img src="http://hub.pimpmylog.com/pml.png?'+c+'" style="opacity:0.01"/>').show(),$("#process").hide(),$("#error").hide(),$("#user").hide(),$("#buttons").hide()})},action_select_logs=function(a){"use strict";var b=a.a,c=a.b,d=a.c,e=40,f=80,g=parseInt(e+(d-c.length)/d*(f-e),10);if(progressbar_set(g),0===c.length)return void action_configure_now(logs_list);var h=c.shift();pml_action({s:"find",so:h},function(a){$("#user").html(a.notice);var e="";0===a.found?progressbar_color("danger"):1===a.found?progressbar_color("warning"):(progressbar_color(),e='style="display:none;"'),$("#find").addClass("table table-striped table-bordered table-hover").append('<thead><tr><th><input type="checkbox" id="all"></th><th>'+lemma.path+"</th><th>"+lemma.file+"</th><th>"+lemma.type+"</th><th>"+lemma.readable+"</th></tr></thead><tbody></tbody>");for(var f in a.files)for(var g in a.files[f])if(a.files[f][g]===!0)$("#find tbody").append("<tr "+e+"><td></td><td>"+g+'</td><td></td><td></td><td><span class="label label-success">'+lemma.yes+"</span></td></tr>");else if(a.files[f][g]===!1)$("#find tbody").append("<tr "+e+"><td></td><td>"+g+'</td><td></td><td></td><td><span class="label label-danger">'+lemma.no+"</span></td></tr>");else for(var h in a.files[f][g])for(var i in a.files[f][g][h]){var j=a.files[f][g][h][i];$("<tr>").data("file",{s:f,f:g+j,t:h}).html('<td><input type="checkbox"></td><td>'+g+"</td><td>"+j+"</td><td>"+h+'</td><td><span class="label label-success">'+lemma.yes+"</span></td>").appendTo("#find tbody")}$("#find tbody tr").click(function(){$(this).find('input[type="checkbox"]').click()}),$('#find tbody tr input[type="checkbox"]').click(function(a){a.stopPropagation();var b=$(this).prop("checked");b?$(this).parents("tr").addClass("success"):$(this).parents("tr").removeClass("success")}),$("#find #all").click(function(){var a=$(this).prop("checked");$("#find tbody tr").each(function(){var b=$(this).find('input[type="checkbox"]');1===b.length&&($(b).prop("checked",a),a?$(this).addClass("success"):$(this).removeClass("success"))})}),$("#find #all").click(),$("#next").unbind("click").click(function(){var a=!1,e=[];return $(".userpaths").each(function(){var a=$.trim($(this).val()).split(/[\n,]+/);if(a.length>0)for(var b in a){var c=$.trim(a[b]);""!==c&&e.push({s:$(this).data("soft"),t:$(this).data("type"),f:c})}}),e.length>0?void pml_action({s:"check",uf:e},function(a){a.notice?$(".alert").removeClass("alert-success").addClass("alert-danger").html(a.notice):($("#error").text(""),$(".alert").remove(),$('#find tbody tr input[type="checkbox"]:checked').each(function(){logs_list.push($(this).parents("tr").data("file"))}),logs_list=$.merge(logs_list,a.found),action_select_logs({a:b,b:c,c:d}))}):($('#find tbody tr input[type="checkbox"]:checked').each(function(){logs_list.push($(this).parents("tr").data("file")),a=!0}),void(a===!0?($("#error").text(""),$(".alert").remove(),action_select_logs({a:b,b:c,c:d})):$(".alert").removeClass("alert-success").addClass("alert-danger").html(lemma.chooselog)))})})},process_authentication=function(){progressbar_set(5),pml_action({s:"auth"},function(a){$("#user").html(a.notice)})},process_authentication_no=function(){user_wants_auth=!1,process_select_logs()},process_authentication_yes=function(){user_wants_auth=!0,progressbar_set(10),pml_action({s:"authtouch"},function(a){a.notice?($("#user").html(a.notice),progressbar_color("warning")):(progressbar_set(15),$("#user").html(a.authform),$("#authsave").submit(function(a){var b=$("#username").val(),c=$("#password").val(),d=$("#password2").val(),e=!0;return $("#usernamegroup").removeClass("has-error").removeClass("has-success").tooltip("hide"),$("#passwordgroup").removeClass("has-error").removeClass("has-success").tooltip("hide"),$("#password2group").removeClass("has-error").removeClass("has-success").tooltip("hide"),0===b.length&&($("#usernamegroup").addClass("has-error").tooltip("show"),e=!1),c.length<6&&($("#passwordgroup").addClass("has-error").tooltip("show"),e=!1),d!==c&&($("#password2group").addClass("has-error").tooltip("show"),e=!1),e===!0&&process_authentication_save(b,c),a.preventDefault(),!1}))})},process_authentication_save=function(a,b){progressbar_set(25),pml_action({s:"authsave",u:a,p:b},function(a){a.notice===!0?process_select_logs():fatal_error()})},process_select_logs=function(){progressbar_set(30),pml_action({s:"touch"},function(a){a.notice?($("#user").html(a.notice),progressbar_color("warning")):($("#user").html(lemma.pleasewait),progressbar_set(35),pml_action({s:"soft"},function(a){if(a.sofn>0){var b=[];if(a.sofn>1){$("#user").html(a.notice),$("#soft").addClass("table table-striped table-bordered table-hover").append('<thead><tr><th><input type="checkbox" id="all"></th><th>'+lemma.name+"</th><th>"+lemma.description+"</th><th>"+lemma.notes+"</th></tr></thead><tbody></tbody>");for(var c in a.soft){var d=a.soft[c].home,e=void 0===d||""===d?a.soft[c].name:'<a href="'+d+'" target="doc">'+a.soft[c].name+"</a>";$("<tr>").data("softid",c).data("load",a.soft[c].load).html('<td><input type="checkbox"></td><td>'+e+"</td><td>"+a.soft[c].desc+"</td><td>"+a.soft[c].notes+"</td>").appendTo("#soft tbody")}$("#soft tbody tr").click(function(){$(this).find('input[type="checkbox"]').click()}),$('#soft tbody tr input[type="checkbox"]').click(function(a){a.stopPropagation();var b=$(this).prop("checked");b?$(this).parents("tr").addClass("success"):$(this).parents("tr").removeClass("success")}),$('#soft tbody tr input[type="checkbox"]').each(function(){$(this).parents("tr").data("load")&&($(this).prop("checked",!0),$(this).parents("tr").addClass("success"))}),$("#soft #all").click(function(){var a=$(this).prop("checked");$("#soft tbody tr").each(function(){var b=$(this).find('input[type="checkbox"]');$(b).prop("checked",a),a?$(this).addClass("success"):$(this).removeClass("success")})}),$("#next").unbind("click").click(function(){$('#soft tbody tr input[type="checkbox"]:checked').each(function(){b.push($(this).parents("tr").data("softid"))}),b.length>0?($("#error").text(""),action_select_logs({a:a.soft,b:b,c:b.length})):$('<div class="alert alert-danger fade in">'+lemma.choosesoftware+"</div>").appendTo("#error")})}else{for(var f in a.soft)b.push(f);action_select_logs({a:a.soft,b:b,c:b.length})}}else fatal_error()}))})},clipboard_enable=function(a,b,c,d){$(a).zclip({path:"../js/ZeroClipboard.swf",copy:function(){return $(b).text()},afterCopy:function(){$(a).popover({html:!0,animation:!0,placement:c,container:"body",delay:{show:100,hide:5e3},content:d}).popover("show"),$(a).on("hidden.bs.popover",function(){$(a).show()})}})};$(function(){"use strict";$(".logo").click(function(){location.reload()}),progressbar_set(5),pml_action({s:"exist"},function(){process_authentication()})});